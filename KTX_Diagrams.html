<!doctype html>
<html lang="vi">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Biểu đồ hệ thống quản lý ký túc xá – Trường Đại học Điện Lực</title>
  <style>
    :root{--fg:#111;--muted:#444;--border:#ddd;--bg:#fff}
    html,body{background:var(--bg);color:var(--fg)}
    body{font-family:Segoe UI,Roboto,Arial,Helvetica,sans-serif;margin:24px;line-height:1.6;max-width:1100px}
    h1,h2{margin:16px 0 8px}
    h1{font-size:28px}
    h2{font-size:22px;border-bottom:1px solid var(--border);padding-bottom:4px}
    .note{color:var(--muted);font-size:14px}
    pre.mermaid{background:#fafafa;border:1px solid #eee;border-radius:6px;padding:12px;overflow:auto}
  </style>
  <script type="module">
    import mermaid from 'https://cdn.jsdelivr.net/npm/mermaid@10/dist/mermaid.esm.min.mjs';
    mermaid.initialize({
      startOnLoad: true,
      theme: 'default',
      themeVariables: { fontSize: '12px', lineHeight: '16px' }
    });

    // Auto-scale ERD to fit a single screen width via query param ?erdscale=0.7 (default 0.75)
    const params = new URLSearchParams(location.search);
    const scale = parseFloat(params.get('erdscale') || '0.75');
    window.addEventListener('DOMContentLoaded', () => {
      const erd = document.getElementById('erdContainer');
      if (erd && !Number.isNaN(scale)) erd.style.setProperty('--scale', String(scale));
      // toolbar buttons
      document.querySelectorAll('[data-erd-scale]')?.forEach(btn => {
        btn.addEventListener('click', () => {
          const v = parseFloat(btn.getAttribute('data-erd-scale'));
          if (!Number.isNaN(v) && erd) erd.style.setProperty('--scale', String(v));
        });
      });
    });
  </script>
  <meta name="color-scheme" content="light" />
  <meta http-equiv="Cache-Control" content="no-store" />
  <meta http-equiv="Pragma" content="no-cache" />
  <meta http-equiv="Expires" content="0" />
  <meta name="referrer" content="no-referrer" />
  <meta name="robots" content="noindex,nofollow" />
  <meta http-equiv="Content-Security-Policy" content="default-src 'self' 'unsafe-inline' data: https://cdn.jsdelivr.net; script-src 'self' 'unsafe-inline' https://cdn.jsdelivr.net; style-src 'self' 'unsafe-inline'; img-src 'self' data:;" />
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1" />
</head>
<body>
  <h1>Biểu đồ hệ thống quản lý ký túc xá – Trường Đại học Điện Lực</h1>
  <p class="note">Bao gồm: Use Case, Phân rã chức năng, DFD mức 0/1/2, Trình tự (Sequence), Hoạt động (Activity), và ERD (đã sửa cú pháp).</p>

  <h2>Use Case (Tổng quan)</h2>
  <pre class="mermaid">
flowchart LR
  %% Bố cục tổng quan theo module để giảm giao cắt
  %% Actors bên trái/phải, module ở giữa

  subgraph LEFT[ ]
  direction TB
    SV["Sinh viên"]:::actor
    CB["Cán bộ KTX"]:::actor
    BV["Bảo vệ"]:::actor
  end

  subgraph RIGHT[ ]
  direction TB
    KT["Kế toán"]:::actor
    BT["Bảo trì"]:::actor
    QT["Quản trị"]:::actor
  end

  subgraph SYS[HỆ THỐNG QL KTX]
  direction LR
    M1([Tiếp nhận &amp; xét duyệt])
    M2([Phòng/giường])
    M3([Phí &amp; thanh toán])
    M4([Tài sản &amp; bảo trì])
    M5([An ninh &amp; ra/vào])
    M6([Quản trị &amp; báo cáo])
  end

  %% Liên kết mức module (chi tiết xem sơ đồ use case theo module bên dưới)
  SV --> M1
  SV --> M3

  CB --> M1
  CB --> M2
  CB --> M3
  CB --> M5

  KT --> M3
  KT --> M6

  BT --> M4
  BV --> M5

  QT --> M6

  %% Ghi chú: Đăng nhập áp dụng cho mọi tác nhân nên được lược bỏ ở tổng quan để tránh rối
  classDef actor fill:#fff,stroke:#333
  </pre>

  <h2>Use Case – Tiếp nhận &amp; xét duyệt (hàng ngang)</h2>
  <pre class="mermaid">
flowchart LR
  SV["Sinh viên"]:::actor
  CB["Cán bộ KTX"]:::actor

  subgraph UC[Tiếp nhận & xét duyệt]
  direction LR
    UC_Apply([Nộp hồ sơ])
    UC_Validate([Kiểm tra điều kiện])
    UC_Priority([Xếp hạng ưu tiên])
    UC_Approve([Phê duyệt])
    UC_Contract([Ký hợp đồng])
    UC_Checkin([Check-in])
  end

  SV --> UC_Apply
  CB --> UC_Validate
  CB --> UC_Priority
  CB --> UC_Approve
  CB --> UC_Contract
  CB --> UC_Checkin

  classDef actor fill:#fff,stroke:#333
  </pre>

  <h2>Use Case – Phòng/giường (hàng ngang)</h2>
  <pre class="mermaid">
flowchart LR
  CB["Cán bộ KTX"]:::actor

  subgraph UC[Phòng/giường]
  direction LR
    UC_Building([Quản lý khu/nhà])
    UC_RoomType([Quản lý loại phòng])
    UC_Room([Quản lý phòng])
    UC_Bed([Quản lý giường])
    UC_Assign([Phân phòng])
    UC_Change([Đổi phòng])
    UC_Checkout([Trả phòng/Tạm vắng])
  end

  CB --> UC_Building
  CB --> UC_RoomType
  CB --> UC_Room
  CB --> UC_Bed
  CB --> UC_Assign
  CB --> UC_Change
  CB --> UC_Checkout

  classDef actor fill:#fff,stroke:#333
  </pre>

  <h2>Use Case – Phí &amp; thanh toán (hàng ngang)</h2>
  <pre class="mermaid">
flowchart LR
  CB["Cán bộ KTX"]:::actor
  KT["Kế toán"]:::actor
  SV["Sinh viên"]:::actor

  subgraph UC[Phí & thanh toán]
  direction LR
    UC_FeeCfg([Định phí phòng/dịch vụ])
    UC_Meter([Ghi chỉ số])
    UC_Charge([Tính phí tiêu thụ])
    UC_Invoice([Lập hóa đơn])
    UC_Pay([Ghi nhận thanh toán])
    UC_Ar([Công nợ/Đối soát])
  end

  CB --> UC_FeeCfg
  CB --> UC_Meter
  CB --> UC_Charge
  KT --> UC_Invoice
  KT --> UC_Pay
  KT --> UC_Ar
  SV --> UC_Pay

  classDef actor fill:#fff,stroke:#333
  </pre>

  <h2>Use Case – Tài sản &amp; bảo trì (hàng ngang)</h2>
  <pre class="mermaid">
flowchart LR
  CB["Cán bộ KTX"]:::actor
  BT["Bảo trì"]:::actor

  subgraph UC[Tài sản & bảo trì]
  direction LR
    UC_AssetInv([Kiểm kê tài sản])
    UC_AssetAlloc([Phân bổ tài sản])
    UC_TicketCreate([Tạo phiếu bảo trì])
    UC_TicketAssign([Phân công])
    UC_TicketDone([Nghiệm thu & chi phí])
  end

  CB --> UC_AssetInv
  CB --> UC_AssetAlloc
  CB --> UC_TicketCreate
  BT --> UC_TicketAssign
  BT --> UC_TicketDone

  classDef actor fill:#fff,stroke:#333
  </pre>

  <h2>Use Case – An ninh &amp; ra/vào (hàng ngang)</h2>
  <pre class="mermaid">
flowchart LR
  BV["Bảo vệ"]:::actor
  CB["Cán bộ KTX"]:::actor

  subgraph UC[An ninh & ra/vào]
  direction LR
    UC_Gate([Sổ ra/vào])
    UC_Visitor([Khách thăm])
    UC_Violation([Biên bản vi phạm])
    UC_Penalty([Xử lý/Thu phạt])
  end

  BV --> UC_Gate
  BV --> UC_Visitor
  CB --> UC_Violation
  CB --> UC_Penalty

  classDef actor fill:#fff,stroke:#333
  </pre>

  <h2>Use Case – Quản trị &amp; báo cáo (hàng ngang)</h2>
  <pre class="mermaid">
flowchart LR
  QT["Quản trị"]:::actor
  CB["Cán bộ KTX"]:::actor
  KT["Kế toán"]:::actor

  subgraph UC[Quản trị & báo cáo]
  direction LR
    UC_User([Người dùng])
    UC_Role([Vai trò & Phân quyền])
    UC_Config([Cấu hình])
    UC_Audit([Audit log])
    UC_Report([Báo cáo/Export])
  end

  QT --> UC_User
  QT --> UC_Role
  QT --> UC_Config
  QT --> UC_Audit
  QT --> UC_Report
  CB --> UC_Report
  KT --> UC_Report

  classDef actor fill:#fff,stroke:#333
  </pre>

  <h2>Phân rã chức năng</h2>
  <pre class="mermaid">
flowchart TB
  A[Quản lý Ký túc xá]:::root

  subgraph F1[Tiếp nhận &amp; xét duyệt]
    F1_1[Nộp hồ sơ]
    F1_2[Xét duyệt &amp; ưu tiên]
    F1_3[Danh sách chờ]
    F1_4[Ký hợp đồng]
    F1_5[Nhận phòng/Check-in]
  end

  subgraph F2[Quản lý phòng/giường]
    F2_1[Danh mục khu/nhà/tầng]
    F2_2[Loại phòng &amp; sức chứa]
    F2_3[Phân phòng]
    F2_4[Đổi phòng/Trả phòng]
  end

  subgraph F3[Phí &amp; thanh toán]
    F3_1[Định phí phòng &amp; dịch vụ]
    F3_2[Ghi chỉ số điện/nước]
    F3_3[Tính hóa đơn]
    F3_4[Thu/ghi nhận thanh toán]
    F3_5[Công nợ &amp; đối soát]
  end

  subgraph F4[Tài sản &amp; bảo trì]
    F4_1[Kiểm kê tài sản]
    F4_2[Phiếu bảo trì]
    F4_3[Thực hiện &amp; nghiệm thu]
  end

  subgraph F5[An ninh &amp; ra/vào]
    F5_1[Quản lý nội trú]
    F5_2[Sổ ra/vào &amp; khách]
    F5_3[Vi phạm &amp; xử lý]
  end

  subgraph F6[Quản trị &amp; báo cáo]
    F6_1[Người dùng &amp; vai trò]
    F6_2[Cấu hình]
    F6_3[Báo cáo/Phân tích]
  end

  A --- F1
  A --- F2
  A --- F3
  A --- F4
  A --- F5
  A --- F6

  classDef root fill:#fff,stroke:#333,stroke-width:2px
  </pre>

  <h2>Phân rã chức năng – Level 2 (chi tiết)</h2>
  <pre class="mermaid">
flowchart TB
  A[Quản lý Ký túc xá]

  subgraph F1[1. Tiếp nhận & xét duyệt]
    F1_1[Nộp hồ sơ]
    F1_2[Kiểm tra điều kiện]
    F1_3[Xếp hạng ưu tiên]
    F1_4[Duyệt/Không duyệt]
    F1_5[Ký hợp đồng]
    F1_6[Check-in]
  end

  subgraph F2[2. Phòng/giường]
    F2_1[Danh mục khu/nhà]
    F2_2[Loại phòng]
    F2_3[Phòng]
    F2_4[Giường]
    F2_5[Phân phòng]
    F2_6[Đổi phòng]
    F2_7[Trả phòng/Tạm vắng]
  end

  subgraph F3[3. Phí & thanh toán]
    F3_1[Định phí phòng/dịch vụ]
    F3_2[Nhập chỉ số điện/nước]
    F3_3[Tính phí tiêu thụ]
    F3_4[Lập hóa đơn kỳ]
    F3_5[Thu tiền/Đối soát]
    F3_6[Quản lý công nợ]
  end

  subgraph F4[4. Tài sản & bảo trì]
    F4_1[Kiểm kê tài sản]
    F4_2[Phân bổ tài sản phòng]
    F4_3[Tiếp nhận phiếu bảo trì]
    F4_4[Phân công & xử lý]
    F4_5[Nghiệm thu & chi phí]
  end

  subgraph F5[5. An ninh]
    F5_1[Sổ ra/vào]
    F5_2[Khách thăm]
    F5_3[Lập biên bản vi phạm]
    F5_4[Xử lý/Thu tiền phạt]
  end

  subgraph F6[6. Quản trị & báo cáo]
    F6_1[Người dùng]
    F6_2[Vai trò & Phân quyền]
    F6_3[Cấu hình & Audit]
    F6_4[Báo cáo/Thống kê/Export]
  end

  A --- F1
  A --- F2
  A --- F3
  A --- F4
  A --- F5
  A --- F6
  </pre>

  <h2>DFD – Mức 0 (Khung cảnh)</h2>
  <pre class="mermaid">
flowchart LR
  ext_sv((Sinh viên)):::actor
  ext_cb((Cán bộ KTX)):::actor
  ext_fin((Kế toán/Tài chính \n Cổng thanh toán/Ngân hàng)):::actor
  ext_sis((SIS)):::actor
  ext_msg((Email/SMS)):::actor

  sys[[HỆ THỐNG QL KÝ TÚC XÁ]]:::system

  ext_sv -- Đơn đăng ký / Tra cứu / Thanh toán --> sys
  sys -- Thông báo / Hợp đồng / Hóa đơn / Biên lai --> ext_sv

  ext_cb -- Phê duyệt / Phân phòng / Ghi chỉ số --> sys
  sys -- Báo cáo / Danh sách --> ext_cb

  ext_fin -- Xác nhận giao dịch / Đối soát --> sys
  sys -- Yêu cầu thanh toán / Ủy nhiệm chi --> ext_fin

  ext_sis -- Thông tin SV --> sys
  sys -- Cập nhật trạng thái (tùy chọn) --> ext_sis

  sys -- Email/SMS thông báo --> ext_msg

  classDef actor fill:#fff,stroke:#333
  classDef system fill:#eef,stroke:#66f
  </pre>

  <h2>DFD – Mức 1 (Đỉnh)</h2>
  <pre class="mermaid">
flowchart TB
  D1[(D1: RESIDENTS)]
  D2[(D2: ROOMS/BEDS)]
  D3[(D3: CONTRACTS)]
  D4[(D4: INVOICES)]
  D5[(D5: PAYMENTS)]
  D6[(D6: METER_READINGS)]
  D7[(D7: MAINT_TICKETS)]
  D8[(D8: VIOLATIONS)]
  D9[(D9: VISITOR_LOG)]
  D10[(D10: USERS/ROLES)]
  D11[(D11: CONFIG/AUDIT)]

  P1[[1. Tiếp nhận &amp; xét duyệt]]
  P2[[2. Phân phòng &amp; hợp đồng]]
  P3[[3. Ghi chỉ số &amp; tính phí]]
  P4[[4. Hóa đơn &amp; thanh toán]]
  P5[[5. Bảo trì]]
  P6[[6. An ninh/Vi phạm]]
  P7[[7. Báo cáo &amp; quản trị]]

  ext_sv((SV)):::actor -->|Hồ sơ| P1
  P1 -->|Nội trú| D1
  P1 -->|Quyết định| P2

  P2 -->|Cập nhật phòng/giường| D2
  P2 -->|Hợp đồng| D3

  P3 -->|Chỉ số| D6
  P3 -->|Mục tính phí| D4

  P4 -->|Hóa đơn| D4
  P4 -->|Thanh toán| D5

  P5 -->|Phiếu| D7
  P6 -->|Vi phạm| D8
  P6 -->|Ra/vào| D9

  P7 -->|Người dùng, phân quyền| D10
  P7 -->|Cấu hình/Audit| D11

  classDef actor fill:#fff,stroke:#333
  </pre>

  <h2>DFD – Mức 2 (Phân phòng)</h2>
  <pre class="mermaid">
flowchart TB
  subgraph P2[Phân phòng &amp; hợp đồng]
    S1[Tiếp nhận yêu cầu]
    S2[Kiểm tra điều kiện / ưu tiên]
    S3[Tra cứu phòng trống]
    S4[Đề xuất giường]
    S5[Phê duyệt &amp; xác nhận]
    S6[Tạo hợp đồng &amp; đặt cọc]
    S7[Check-in]
  end

  D1[(RESIDENTS)]
  D2[(ROOMS/BEDS)]
  D3[(CONTRACTS)]

  S1 --> S2 --> S3 --> S4 --> S5 --> S6 --> S7
  S2 -->|Tra cứu| D1
  S3 -->|Tồn| D2
  S6 -->|Ghi hợp đồng| D3
  S5 -->|Giữ chỗ| D2
  S7 -->|Cập nhật trạng thái giường| D2
  </pre>

  <h2>DFD – Mức 2 (Tính phí &amp; Hóa đơn)</h2>
  <pre class="mermaid">
flowchart TB
  subgraph P34[Tính phí &amp; Hóa đơn]
    T1[Chốt kỳ &amp; chốt chỉ số]
    T2[Tính tiêu thụ điện/nước]
    T3[Tính phí phòng &amp; dịch vụ]
    T4[Lập hóa đơn kỳ]
    T5[Ghi nhận thanh toán]
    T6[Đối soát &amp; công nợ]
  end

  D3[(CONTRACTS)]
  D4[(INVOICES)]
  D5[(PAYMENTS)]
  D6[(METER_READINGS)]

  T1 --> T2 --> T3 --> T4 --> T5 --> T6
  T1 -->|Chốt số| D6
  T3 -->|Mục tính phí| D4
  T4 -->|Hóa đơn| D4
  T5 -->|Phiếu thu| D5
  </pre>

  <h2>Sơ đồ trình tự (Sequence)</h2>
  <pre class="mermaid">
sequenceDiagram
  actor CB as Cán bộ KTX
  participant UI as Form Phân phòng
  participant DB as CSDL
  CB->>UI: Nhập yêu cầu phân phòng
  UI->>DB: Tra cứu phòng/giường trống
  DB-->>UI: Danh sách gợi ý
  CB->>UI: Chọn giường &amp; xác nhận
  UI->>DB: Ghi hợp đồng + cập nhật giường
  DB-->>UI: OK
  UI-->>CB: Hoàn tất phân phòng
  </pre>

  <pre class="mermaid">
sequenceDiagram
  actor KT as Kế toán
  participant UI as Form Hóa đơn
  participant DB as CSDL
  KT->>UI: Chốt kỳ YYYYMM
  UI->>DB: Lấy chỉ số công tơ
  DB-->>UI: Chỉ số Prev/Curr
  UI->>UI: Tính tiêu thụ &amp; phí
  UI->>DB: Lập hóa đơn + chi tiết
  DB-->>UI: OK
  UI-->>KT: In/Xuất hóa đơn
  </pre>

  <pre class="mermaid">
sequenceDiagram
  actor SV as Sinh viên
  participant UI as Cổng thanh toán
  participant PAY as Cổng ngân hàng
  participant DB as CSDL
  SV->>UI: Thanh toán hóa đơn
  UI->>PAY: Tạo giao dịch
  PAY-->>UI: Kết quả giao dịch
  UI->>DB: Cập nhật phiếu thu &amp; trạng thái
  DB-->>UI: OK
  UI-->>SV: Biên lai/Thông báo
  </pre>

  <pre class="mermaid">
sequenceDiagram
  actor BT as Kỹ thuật/Bảo trì
  participant UI as Form Bảo trì
  participant DB as CSDL
  participant CB as Cán bộ KTX
  CB->>UI: Tạo phiếu bảo trì (phòng, hạng mục)
  UI->>DB: Lưu phiếu trạng thái Open
  DB-->>UI: ID phiếu
  BT->>UI: Nhận &amp; cập nhật trạng thái Assigned
  UI->>DB: Cập nhật tiến độ/chi phí
  BT->>UI: Hoàn thành &amp; Nghiệm thu
  UI->>DB: Đóng phiếu (Done)
  </pre>

  <pre class="mermaid">
sequenceDiagram
  actor CB as Cán bộ KTX
  participant UI as Form Vi phạm
  participant DB as CSDL
  CB->>UI: Lập biên bản vi phạm
  UI->>DB: Lưu vi phạm (Open)
  CB->>UI: Quyết định xử phạt
  UI->>DB: Ghi tiền phạt &amp; cập nhật hóa đơn/phiếu thu
  DB-->>UI: OK
  UI-->>CB: Đóng vi phạm (Closed)
  </pre>

  <h2>Sơ đồ hoạt động (Activity)</h2>
  <pre class="mermaid">
flowchart TD
  A[Nhận hồ sơ] --> B{Đủ điều kiện?}
  B -- Không --> C[Từ chối/DS chờ]
  B -- Có --> D[Phân loại ưu tiên]
  D --> E[Đề xuất phòng/giường]
  E --> F{Còn chỗ?}
  F -- Không --> C
  F -- Có --> G[Thông báo &amp; ký hợp đồng]
  G --> H[Check-in]
  </pre>

  <pre class="mermaid">
flowchart TD
  A[Chốt kỳ hóa đơn] --> B[Khóa nhập chỉ số]
  B --> C[Lấy chỉ số Prev/Curr]
  C --> D[Tính tiêu thụ]
  D --> E[Tính phí phòng/dịch vụ]
  E --> F[Lập hóa đơn]
  F --> G[Gửi thông báo]
  G --> H[Thu tiền/Đối soát]
  </pre>

  <pre class="mermaid">
flowchart TD
  A[Đề nghị đổi phòng] --> B{Có phòng phù hợp?}
  B -- Không --> C[Thông báo từ chối]
  B -- Có --> D[Giải phóng giường cũ]
  D --> E[Cập nhật hợp đồng]
  E --> F[Cập nhật giường mới]
  F --> G[Hoàn tất đổi phòng]
  </pre>

  <pre class="mermaid">
flowchart TD
  A[Yêu cầu trả phòng] --> B[Đối soát công nợ]
  B --> C[Kiểm kê tài sản]
  C --> D[Chốt điện/nước]
  D --> E[Hóa đơn kết thúc]
  E --> F[Thu tiền/Hoàn cọc]
  F --> G[Trả phòng &amp; đóng hợp đồng]
  </pre>

  <h2>ERD (đã sửa cú pháp Mermaid)</h2>
  <p class="note">Tip: đổi tỷ lệ bằng nút dưới hoặc thêm tham số URL, ví dụ: <code>?erdscale=0.6</code>.</p>
  <div style="margin:8px 0">
    <button data-erd-scale="0.5">50%</button>
    <button data-erd-scale="0.6">60%</button>
    <button data-erd-scale="0.7">70%</button>
    <button data-erd-scale="0.8">80%</button>
    <button data-erd-scale="1">100%</button>
  </div>
  <div id="erdContainer" class="erd-scale" style="--scale:0.75">
  <pre class="mermaid">
erDiagram
  BUILDING {
    int BuildingId
    string Code
    string Name
    string Address
  }
  ROOM_TYPE {
    int RoomTypeId
    string Code
    string Name
    int Capacity
    decimal BasePrice
  }
  ROOM {
    int RoomId
    int BuildingId
    int RoomTypeId
    string Number
    int Floor
    string Status
  }
  BED {
    int BedId
    int RoomId
    string BedNo
    string Status
  }

  RESIDENT {
    int ResidentId
    string StudentCode
    string FullName
    string Gender
    date DoB
    string Phone
    string Email
    string Department
    string Class
  }
  CONTRACT {
    int ContractId
    int ResidentId
    int BedId
    date StartDate
    date EndDate
    string Status
    decimal DepositAmount
  }

  SERVICE {
    int ServiceId
    string Code
    string Name
    string Unit
    decimal Price
  }
  UTILITY_METER {
    int MeterId
    int RoomId
    string Type
    string Serial
    bool Active
  }
  METER_READING {
    int ReadingId
    int MeterId
    string Period
    decimal PrevIndex
    decimal CurrIndex
  }

  INVOICE {
    int InvoiceId
    int ContractId
    string Period
    date IssueDate
    date DueDate
    string Status
    decimal TotalAmount
  }
  INVOICE_ITEM {
    int ItemId
    int InvoiceId
    string ItemType
    int RefId
    string Description
    decimal Qty
    decimal UnitPrice
    decimal Amount
  }
  PAYMENT {
    int PaymentId
    int InvoiceId
    date PaidDate
    string Method
    string RefNo
    decimal Amount
    string Status
  }

  ASSET {
    int AssetId
    string Code
    string Name
    string Unit
    decimal Price
  }
  ROOM_ASSET {
    int RoomId
    int AssetId
    decimal Qty
  }

  MAINTENANCE_TICKET {
    int TicketId
    int RoomId
    string ReportedBy
    date ReportedAt
    string Category
    string Content
    string Status
    decimal Cost
  }
  VIOLATION {
    int ViolationId
    int ResidentId
    date Date
    string Category
    string Detail
    decimal Penalty
    string Status
  }
  VISITOR_LOG {
    int VisitId
    int ResidentId
    int RoomId
    string VisitorName
    string IdNo
    date InAt
    date OutAt
    string Note
  }

  USER {
    int UserId
    string Username
    string FullName
    string Email
    string PasswordHash
    string Status
  }
  ROLE {
    int RoleId
    string Code
    string Name
  }
  USER_ROLE {
    int UserId
    int RoleId
  }

  BUILDING ||--o{ ROOM : has
  ROOM_TYPE ||--o{ ROOM : defines
  ROOM ||--o{ BED : contains

  RESIDENT ||--o{ CONTRACT : signs
  BED ||--o{ CONTRACT : allocated

  CONTRACT ||--o{ INVOICE : generates
  INVOICE ||--o{ INVOICE_ITEM : includes
  INVOICE ||--o{ PAYMENT : paidBy

  ROOM ||--o{ UTILITY_METER : has
  UTILITY_METER ||--o{ METER_READING : records

  ROOM ||--o{ ROOM_ASSET : equippedWith
  ASSET ||--o{ ROOM_ASSET : assigned

  ROOM ||--o{ MAINTENANCE_TICKET : raises
  RESIDENT ||--o{ VIOLATION : violates
  RESIDENT ||--o{ VISITOR_LOG : visits
  ROOM ||--o{ VISITOR_LOG : visits

  USER ||--o{ USER_ROLE : has
  ROLE ||--o{ USER_ROLE : grants
  </pre>
  </div>

</body>
</html>
